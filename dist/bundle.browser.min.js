var o=(i,e,t)=>new Promise((n,r)=>{var g=a=>{try{c(t.next(a))}catch(m){r(m)}},b=a=>{try{c(t.throw(a))}catch(m){r(m)}},c=a=>a.done?n(a.value):Promise.resolve(a.value).then(g,b);c((t=t.apply(i,e)).next())});var d=class{constructor(e={}){this.username=e.username||void 0,this.token=e.token||void 0,this.confirmationCode=e.confirmationCode||void 0}};var u=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{let e=Math.random()*16|0;return(i=="x"?e:e&3|8).toString(16)}),p=class{constructor(e){this.observers=[];this.id=e!=null?e:u()}getId(){return this.id}subscribe(){return new l(this)}registerObserver(e){this.observers.push(e)}unregisterObserver(e){this.observers.forEach((t,n)=>{t.getId()===e.getId()&&(e.emit({type:"final",data:null}),this.observers.splice(n,1))})}unregisterObservers(){this.finally(),this.observers=[]}emit(e){this.observers.forEach(t=>t.emit({type:"data",data:e}))}error(e){this.observers.forEach(t=>t.emit({type:"error",data:e}))}finally(){this.observers.forEach(e=>e.emit({type:"final",data:null}))}},l=class{constructor(e){this.isSubscribed=!0;this.id=u(),this.observable=e,this.observable.registerObserver(this)}getId(){return this.id}unsubscribe(){this.isSubscribed=!1,this.observable.unregisterObserver(this)}emit({type:e,data:t}){switch(e){case"data":if(!this.onData||!!this.onData&&typeof this.onData!="function")throw Error("no callable in .then() callback!");this.onData(t);break;case"error":if(!this.onError||!!this.onError&&typeof this.onError!="function")throw Error(t);this.onError(t);break;case"final":this.isSubscribed=!1,typeof this.onFinal=="function"&&this.onFinal(t);break}}then(e){if(!e||!!e&&typeof e!="function")throw Error("no callable in .then() callback!");return this.onData=e,this}error(e){return this.onError=e,this}finally(e){return this.onFinal=e,this}};var s=class{constructor(e){this.onContextUpdate=new p("onContextUpdate");this.onError=new p("onError");this.onLogout=new p("onLogout");var t;this.appName=e.appName,this.auth=(t=e.auth)!=null?t:new d}setAuth(e){this.auth=e}getAuth(){return this.auth}getHeaders(e="application/json"){return{Accept:e,"Content-Type":e,Authorization:`Bearer ${this.auth.token}`,"User-Agent":this.appName}}fetch(e){return o(this,null,function*(){try{let t=yield fetch(`https://nyx.cz/api/${e.endpoint}`,{method:e.method,headers:e.headers||this.getHeaders(),body:e.body}).then(n=>n.json()).catch(n=>this.processError(n));return t.error?this.processError(t):((t==null?void 0:t.context)&&this.updateContext(t.context),t)}catch(t){return this.processError(t)}})}updateContext(e){this.onContextUpdate.emit(e)}processError(e){let t=(e==null?void 0:e.message)||(e==null?void 0:e.error)||"Chyba spojen\xED";return this.onError.emit(t),{bookmarks:[],discussions:[],posts:[],error:t,code:e==null?void 0:e.code}}};s.DELETE="DELETE",s.GET="GET",s.POST="POST",s.PUT="PUT";var h=class extends s{constructor(e){super(e)}createAuthToken(e){return o(this,null,function*(){let t=yield this.fetch({endpoint:`create_token/${e}`,method:s.POST,headers:{"User-Agent":this.appName}});if((t==null?void 0:t.token)&&t.confirmation_code)return this.auth=new d({username:e,token:t.token,confirmationCode:t.confirmation_code}),this.auth;throw new Error((t==null?void 0:t.error)||"Error requesting token")})}logout(){return o(this,null,function*(){yield this.deleteAuthToken(),this.onLogout.emit()})}deleteAuthToken(){return o(this,null,function*(){return this.fetch({endpoint:`delete_token/${this.auth.token}`,method:s.POST})})}getBookmarks(e=!0){return o(this,null,function*(){return this.fetch({endpoint:`bookmarks${e?"/all":""}`,method:s.GET})})}getHistory(e=!0,t){return o(this,null,function*(){return this.fetch({endpoint:`bookmarks/history?more_results=true&show_read=${e}${t!==void 0?`&show_booked=${t}`:""}`,method:s.GET})})}getContext(){return o(this,null,function*(){return this.fetch({endpoint:"status",method:s.GET})})}getLastPosts(e=0,t,n){return o(this,null,function*(){return this.fetch({endpoint:`last${e>0?`/min_rating/${e}`:""}${t?"/rated_by_friends":""}${n?"/rated_by_me":""}`,method:s.GET})})}getLastDiscussions(){return o(this,null,function*(){return this.fetch({endpoint:"last/discussions",method:s.GET})})}search(e,t=!1,n=!1,r=20){return o(this,null,function*(){return n&&(e==null?void 0:e.length)<2?{exact:[]}:this.fetch({endpoint:`search${t?"/unified":n?"/username/":""}${n?e:`?search=${e}&limit=${r}`}`,method:s.GET})})}getDiscussion(e){return o(this,null,function*(){return this.fetch({endpoint:`discussion/${e}`,method:s.GET})})}getDiscussionBoard(e){return o(this,null,function*(){return this.fetch({endpoint:`discussion/${e}/content/home`,method:s.GET})})}getDiscussionStats(e){return o(this,null,function*(){return this.fetch({endpoint:`discussion/${e}/stats`,method:s.GET})})}getMail(e=""){return o(this,null,function*(){return this.fetch({endpoint:`mail${e}`,method:s.GET})})}getReminders(e){return o(this,null,function*(){return this.fetch({endpoint:`${e}/reminders`,method:s.GET})})}getWaitingFiles(e){return o(this,null,function*(){return this.fetch({endpoint:`${e?`discussion/${e}`:"mail"}/waiting_files`,method:s.GET})})}getNotifications(){return o(this,null,function*(){return this.fetch({endpoint:"notifications",method:s.GET})})}getRating(e){return o(this,null,function*(){return this.fetch({endpoint:`discussion/${e.discussion_id}/rating/${e.id}`,method:s.GET})})}ratePost(e,t){return o(this,null,function*(){return this.fetch({endpoint:`discussion/${e.discussion_id}/rating/${e.id}/${t}`,method:s.POST})})}setReminder(e,t,n){return o(this,null,function*(){return this.fetch({endpoint:`${e>0?`discussion/${e}`:"mail"}/reminder/${t}/${n}`,method:s.POST})})}reportPost(e){return o(this,null,function*(){return this.fetch({endpoint:`report/${e}`,method:s.POST})})}sendPrivateMessage(e,t){return o(this,null,function*(){let n={recipient:e,message:t};return this.fetch({endpoint:"mail/send",method:s.POST,headers:this.getHeaders("application/x-www-form-urlencoded"),body:Object.keys(n).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(n[r])).join("&")})})}bookmarkDiscussion(e,t,n){return o(this,null,function*(){return this.fetch({endpoint:`discussion/${e}/bookmark?new_state=${t}${n&&n>0?`&category=${n}`:""}`,method:s.POST})})}rollDice(e,t){return o(this,null,function*(){return this.fetch({endpoint:`discussion/${e}/dice/${t}/roll`,method:s.POST})})}rollDiceInHeader(e,t){return o(this,null,function*(){return this.fetch({endpoint:`discussion/${e}/content/dice/${t}/roll`,method:s.POST})})}voteInPoll(e,t,n){return o(this,null,function*(){return this.fetch({endpoint:`discussion/${e}/poll/${t}/vote/${n.toString()}`,method:s.POST})})}voteInHeaderPoll(e,t,n){return o(this,null,function*(){return this.fetch({endpoint:`discussion/${e}/content/poll/${t}/vote/${n.toString()}`,method:s.POST})})}postToDiscussion(e,t){return o(this,null,function*(){let n={content:t};return this.fetch({endpoint:`discussion/${e}/send/text`,method:s.POST,headers:this.getHeaders("application/x-www-form-urlencoded"),body:Object.keys(n).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(n[r])).join("&")})})}deletePost(e,t){return o(this,null,function*(){return this.fetch({endpoint:`discussion/${e}/delete/${t}`,method:s.DELETE})})}uploadFile(e,t){return o(this,null,function*(){let n=new FormData;return n.append("file",e),n.append("file_type",t?"discussion_attachment":"mail_attachment"),n.append("id_specific",`${t||0}`),this.fetch({endpoint:"file/upload",method:s.PUT,headers:{Authorization:`Bearer ${this.auth.token}`},body:n})})}deleteFile(e){return o(this,null,function*(){return this.fetch({endpoint:`file/delete/${e}`,method:s.DELETE})})}subscribeForFCM(e,t){return o(this,null,function*(){return this.fetch({endpoint:`register_for_notifications/${this.auth.token}/${t}/${e}`,method:s.POST})})}unregisterFromFCM(e,t){return o(this,null,function*(){return this.fetch({endpoint:`deregister_notifications/${this.auth.token}/${t}/${e}`,method:s.POST})})}};var Ge=h;export{p as Observable,l as Observer,Ge as default,u as generateUuidV4};
